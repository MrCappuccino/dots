#!/bin/bash
time=${1-30} # Time defaults to 30min
region=${2:-nl} # Default region to NL

# Default lat and lon values (Eindhoven)
var2=$(echo 51.4393 | bc)
var3=$(echo 5.47863 | bc)

# Latitude and Longitude
lat=${3:-$var2}
lon=${4:-$var3}

#url=$(curl "https://cdn-secure.buienalarm.nl/api/3.4/forecast.php?lat="$lat"&lon="$lon"&region="$region"&unit=mm/u")
url=$(curl "https://cdn-secure.buienalarm.nl/api/3.4/forecast.php?lat=""$lat""&lon=""$lon""&region=""$region""&unit=mm/u")

temp=$(echo "$url" | jq -r .temp) # Temperature

precipitation_info() { # Output all precipitation data
    mapfile -t whole < <(jq -r .precip[] <<< "$url") # All precipitation data in array whole

    for each in "${whole[@]}"
    do
        echo "$each"
    done
}

precipitation_info1() {
    indice=$(($1 / 5)) # buienalarm sends precipitation data every 5min

    precip=$(echo "$url" | jq --argjson indice "$indice" ' .precip[:$indice] | max')

    if (( $(echo "$precip > 2.5" |bc -l)  )); then
        echo "Heavy"
    elif (( $(echo "$precip > 1" |bc -l) )); then
        echo "Moderate"
    elif (( $(echo "$precip > 0.25" |bc -l) )); then
        echo "Light"
    elif (( $(echo "$precip > 0.15" |bc -l) )); then
        echo "Drizzle"
    else
        printf "\nNo Rain\n"
    fi
}

precipitation=$(precipitation_info1 "$time")

echo ""$temp"Â°C "$1"min:"$precipitation""
